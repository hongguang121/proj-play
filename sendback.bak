#lang racket

(require web-server/servlet
         web-server/servlet-env
         web-server/formlets
         web-server/formlets/syntax)

(require json)

(provide/contract (start (request? . -> . response?)))

(define req-info '())

(define (start request)
  ;(set! req-info (request-post-data/raw request))
  ;(set! req-info (extract-binding/single 'title (request-bindings request)))
  ;(set! req-info (request-bindings request))
  (set! req-info (request-bindings/raw request))
  (render-response-page req-info request))

(define (render-response-page content request)
    ;(response/xexpr
     ;`(html
     ;  (head)
     ;  (body
     ;   (p "Hello")
        ;,(request-bindings/raw request)
     ;   ,(displayln content)))))
  (response
   200 #"Moved Permanently"
 (current-seconds) TEXT/HTML-MIME-TYPE
 (list (make-header #"Access-Control-Allow-Origin"
                    #"*"))
 (λ (op) (write-bytes #"<html><body>Hello, World!</body></html>" op))))
 
 #|(λ (op) (map (λ (x) (write-string (string-append
                                    (bytes->string/utf-8 (binding:form-value x))
                                    " ")
                                   op)) content))))
 |#
   ;(write-string content op))))
 


(serve/servlet start
               #:launch-browser? #f
               #:quit? #f
               #:listen-ip #f
               #:port 8400
               #:extra-files-paths (list "e:\\hg\\MyWordsWeb")
               #:servlet-path "/sendback"
               #:command-line? #f
               #:stateless? #f)